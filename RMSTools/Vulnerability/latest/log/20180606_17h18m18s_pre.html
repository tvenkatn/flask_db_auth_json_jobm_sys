<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Vulnerability validation tool</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>





<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h1>Vulnerability validation tool</h1>

<p>The document is <a href="N:/APPLICS/EngTools/R_packages/MDValidation/Vulnerability/Vulnerability_ToolRequirement.docx">here</a></p>

<blockquote>
<p>Date run:  2018-06-06 17:18:23</p>

<p>Vuln database: RMS_VULN_JPEQHD_v17b    (ca1mdtools01)</p>
</blockquote>

<p>This tool tests the integrity of Vulncache\Vulnerability database and verifies that the data is properly transferred between RL tables and HD tables</p>

<h4>Test-0: Database Information</h4>

<p>Check if database includes  both RiskLink and HD Tables or only includes RiskLink Tables</p>

<pre><code>        List of countries:JP
        List of perils:EQ
        Database includes risklink tables.
        Database includes HD tables.
</code></pre>

<p>The Countries in this database are jp .</p>

<h4>Test-0.1: Use &ldquo;CS&rdquo; instead of &ldquo;TO&rdquo; Tables. (Only for TO) <a href="https://jira.rms.com/browse/MDF-87">https://jira.rms.com/browse/MDF-87</a></h4>

<pre><code>         PASS! Database Does Not Contain &#39;TO&#39; Peril
</code></pre>

<h4>Test-1: Tables Availability</h4>

<p>Tests if all tables listed in &ldquo;VulnDb_ExpectedTables.csv&rdquo; file located in data folder are included in the input database.</p>

<pre><code>          Check risklink tables: 
          WARNING! 
         eqvlifjp
         eqvlljp

          Check HD tables: 
         vll
         LandMDR
         LiqMDR
         vinvaghaz
         vlif
</code></pre>

<h4>Test-2: Empty Tables</h4>

<p>Check for empty tables </p>

<pre><code>          Check risklink tables: 
          WARNING! 
         eqvmodjp
         eqvpdcdscjp
         eqvuwtjp
         eqvyrjp

          CHECK NG TABLES: 
         WARNING!
         vvrggeo
</code></pre>

<h4>Test-3: Risklink Tables Without Index</h4>

<p>Check for indexing only in RL tables. HD tables will be eventually converted to binaries.</p>

<pre><code>
EQ-JP:
         WARNING!
         eqvbijp
         eqvbimodjp
         eqvgeojp
         eqvinvjp
</code></pre>

<h4>Test-4: Comparison of Number of Rows in corresponding RL/ HD tables (HD Only)</h4>

<p>This test compares the number of rows in each RislLink Table with its corresponding table in the HD and reports any dissimilarity.</p>

<pre><code>         WARNING!
          NG            RL
1:        NA            NA
2:       vll       eqvlljp
3:      vgeo      eqvgeojp
4: vinvaghaz eqvinvaghazjp
5:      vlif      eqvlifjp
</code></pre>

<h4>Test-5: Consistency of Data within VGEO Table and Comparison Between RL And HD Versions of VGEO Table (HD Only)</h4>

<ol>
<li> Checks and reports duplicate postal codes in vgeo table</li>
<li> Checks and reports duplicate district numbers</li>
<li> Checks for the number of distinct states in vgeo table</li>
<li> Check if records with the same GEO_RECNUM have the same values in both RL and NG vgeo tables</li>
<li> Checks if the last record in vgeo table is a wild card</li>
<li> All admin geoids in a record cannot be zero except for the wild card. The test checks for this criteria and reports if the criteria is not satisfied. </li>
</ol>

<pre><code>
JP:
         PASS! No Duplicate Postalcodes!

-----------------------------------------------------------------------------------------------------------------
         Numberof Distinct Admin1Code (States) =47

-----------------------------------------------------------------------------------------------------------------
         Numberof Distinct Admin2Code (Counties) =1

-----------------------------------------------------------------------------------------------------------------
         FAIL! Number of rows with unmatched state or district fields =23
    NG-GeoRecnum RL-GeoRecnum NG-Admin1Code STATE Admin2Code COUNTYNUM
 1:        22369        22369            43    91         NA        NA
 2:        22370        22370            10    40         NA        NA
 3:        22372        22372            24    60         NA        NA
 4:        22375        22375            81    64         NA        NA
 5:        22377        22377            41    58         NA        NA
 6:        22378        22378            22    82         NA        NA
 7:        22380        22380             1    50         NA        NA
 8:        22381        22381            59    63         NA        NA
 9:        22383        22383            32    21         NA        NA
10:        22384        22384             3    72         NA        NA
11:        22386        22386            92    62         NA        NA
12:        22387        22387            26    31         NA        NA
13:        22389        22389            84    11         NA        NA
14:        22390        22390            57    71         NA        NA
15:        22373        22373            74    30         NA        NA
16:        22376        22376            12    93         NA        NA
17:        22379        22379            70    23         NA        NA
18:        22371        22371             2    83         NA        NA
19:        22374        22374            33    90         NA        NA
20:        22388        22388            80    61         NA        NA
21:        22391        22391            44    34         NA        NA
22:        22382        22382            20    42         NA        NA
23:        22385        22385            73    25         NA        NA
    NG-GeoRecnum RL-GeoRecnum NG-Admin1Code STATE Admin2Code COUNTYNUM

-----------------------------------------------------------------------------------------------------------------
         PASS! VGEO TABLE INCLUDES THE WILD CARD and it is the last record
-----------------------------------------------------------------------------------------------------------------
         PASS! No row contaons all Admin Geoids equal to zero except the wild card.
-----------------------------------------------------------------------------------------------------------------
</code></pre>

<h4>Test-6: Comparison Between RL and HD Versions of CGHS table (HD Only)</h4>

<ol>
<li> Checks if the records with same cghs_ID, have equivalent Hazard_Type, Hazard_Scale, and Coverage. It uses the mapping tables to find the equivalent values. It reports any dissimilarity between two tables.</li>
<li> Checks if all CVG_GRADEs include only 0 or all values between 0 and 4.</li>
</ol>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS WITH THE SAME CGHS_ID MATCHED BETWEEN TWO TABLES!
         Check for NG Tables:
         PASS! CVG_GRADES ARE BETWEEN 0 AND 4 in CGHS TABLE
         PASS! CVG_GRADES INCLUDE ONLY 0 OR ALL VALUES BETWEEN 0 AND 4 in CGHS TABLE

-----------------------------------------------------------------------------------------------------------------

JP:
         PASS! CVG_GRADES ARE BETWEEN 0 AND 4 in eqcghsjp  TABLE
         PASS! CVG_GRADES INCLUDE ONLY 0 OR ALL VALUES BETWEEN 0 AND 4 in CGHS TABLE

-----------------------------------------------------------------------------------------------------------------
</code></pre>

<h4>Test-7: Comparison Between RL and HD Versions of IMAP table (HD Only)</h4>

<p>Compares equivalent records between RL and HD versions of Imap table and reports dissimilarities. 
This test uses INV_Recnum as the key for comparison. </p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS WITH THE SAME INV_RECNUM MATCHED BETWEEN TWO TABLES!
</code></pre>

<h4>Test-8: Comparison Between RL and HD Versions of VINV Table (HD Only)</h4>

<p>Compares equivalent records between RL and NG versions of vinv table and reports dissimilarities. </p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS WITH THE SAME INV_RECNUM, PDC_GROUP,and PDC_NUM MATCHED BETWEEN TWO TABLES!
</code></pre>

<h4>Test-9: Test VDC0 Table</h4>

<ol>
<li>Check if all damage curves are monotonically increasing</li>
<li>Check if the x-axis on all damage curves are monotonically increasing</li>
<li>Check if curves with the same CGHS_ID have the same number or records</li>
</ol>

<pre><code>
CHECK RISKLINK TABLES: 

EQ-JP:
         PASS! ALL VDC0 CURVES ARE MONOTONICALLY INCREASING!


CHECK NG TABLES: 
         PASS! ALL VDC0 CURVES ARE MONOTONICALLY INCREASING!
         PASS! X-AXES ON ALL VDC0 CURVES ARE MONOTONICALLY INCREASING!
         PASS! ALL CURVES WITH THE SAME CGHS-ID HAVE THE SAME NUMBER OF RECORDS!
</code></pre>

<h4>Test-10: Comparison Between RL and HD Versions of VCC Table (HD Only)</h4>

<p>Compares equivalent records between RL and HD versions of vcc table and reports dissimilarities. </p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-11: Comparison Between RL and HD Versions of VOCC Table (HD Only)</h4>

<p>Compares equivalent records between RL and HD versions of vocc table and reports dissimilarities. </p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-12: Test Existence of Pdc_Num In VINV if the Same Modif_Pdc Exists in IMAP For A Given Inv_Recnum (HD Only)</h4>

<p>This test checks if for any combination of inv_recnum and modif_pdc in imap table there exist a record in vinv table with the same inv_recnum and pdc_num.</p>

<pre><code>
JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-13: Test for Case Sensitivity in Map_Invocc and Map_Invkey Tables</h4>

<p>This test identifies repeated keys in Map_InvOcc and Map_InvKey tables. That can happen if key values are recorded in different capital and lowercase letters. As an example &ldquo;unknown&rdquo; and &ldquo;UnKnown.&rdquo;</p>

<pre><code>         PASS! NO CASE SENSITIVITY PROBLEM IS FOUND!
</code></pre>

<h4>Test-14: Consistency of Data Between VCC and IMAP Tables</h4>

<pre><code>
EQ-JP:
         Warning! Number of records that have not an exact match of combination of MAPCCLSSIF, MAPCCTIER1, MAPCCTIER2, and MAPCCTIER3: 3
         Examples are as follows:
   CC_RECNUM MAPCCLSSIF MAPCCTIER1 MAPCCTIER2 MAPCCTIER3
1:       131        RMS         52         NA         NA
2:       135         BR          0         NA         NA
3:      1000  RMSCGSPEC          0         NA         NA

         Warning! Number of VCC records that have not an exact match but falling back to a record in IMAP which is not wild card: 3
  CC_RECNUM MAPCCLSSIF MAPCCTIER1 MAPCCTIER2 MAPCCTIER3
1       131        RMS         52         NA         NA
2       135         BR          0         NA         NA
3      1000  RMSCGSPEC          0         NA         NA

         Pass! All records of VCC tables have either exact match in IMAP or are falling back to a record.
</code></pre>

<h4>Test-15: Consistency of Data Between VOCC and IMAP Tables</h4>

<p>This test checks if all INV_OCC values in VOCC table exist in IMAP.</p>

<pre><code>
EQ-JP:
         FAIL! Number of unmatched records= 1
         Difference(s) between the vocc and imap include following INV_OCC(s):
         UNK
</code></pre>

<h4>Test-16: Consistency of Data Between VGEO and IMAP Tables</h4>

<p>This test checks if all INV_KEY values in VGEO table exist in IMAP.</p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-17: Integrity of IMAP with VCC, VOCC, VGEO, Using PDC list received from modelers. (NAEQ17 Only)</h4>

<h4>Test-18: All CV Keys in IMAP Should Exist in VCV Table</h4>

<p>This test checks if the list of distinct values of CV_KEY in IMAP table is the same as the list of distinct values of CV_KEY in VCV table. </p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-19: Consistency of Data Between Fliinv and Vcc, Vocc, Vgeo Tables</h4>

<ol>
<li> This test checks if the list of distinct values of FFEQ_OCC in VOCC table is the same as the list of distinct values of FFEQ_OCC filed in FLIINV tables. </li>
<li> Check case sensitivity of FFEQ_OCC in FLIINV and VOCC tables. Any repeated value with the same spelling but different capital or lower-case letters is identified in this test.</li>
<li> Checks if all distinct values of MAPCCLSSIF, MAPCCTIER1, MAPCCTIER2, and MAPCCTIER3 are the same between FLIINV and VCC tables.</li>
<li> Checks if all distinct values of INV_KEY are the same in both FLIINV and VGEO tables.</li>
</ol>

<pre><code>
EQ-JP:
         Does not have FF peril!
</code></pre>

<h4>Test-20: All Secondary Modifiers Should Have Options</h4>

<pre><code>
EQ-JP:
         PASS! ALL Modif PDCs have options.
</code></pre>

<h4>Test-21: All DC_Keys in VHAZ should exist in VGEO table</h4>

<p>This test checks if the list of distinct values of DC_KEY in VHAZ table is the same as the list of distinct values of DC _KEY in VGEO table. </p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-22: Consistency of BI_Key between Vgeo and other BI-Related Tables</h4>

<pre><code>
EQ-JP:
[1] &quot;BI Related tables are :&quot;
               name
 1:      eqcasvbijp
 2:         eqvbijp
 3:   eqcasvbimodjp
 4:      eqvbimodjp
 5:     eqvvrggeojp
 6:        eqvgeojp
 7:     eqcasvgeojp
 8: eqvlifelinebijp
 9:     eqcasvlifjp
10:      eqcasvlljp
         FAIL! Number of tables with different BI_KEYS= 4
         Distinct BI_KEYs in the following table(s) does not match distinct BI_KEYS in VGEO table:
         eqcasvbimodjp
         PASS! No CASE SENSITIVITY PROBLEM IN BI_KEYs IS FOUND!
</code></pre>

<h4>Test-23: All INV_Recnums In IMAP Should Exist in VRS Table</h4>

<p>This test checks if the list of distinct values of INV_RECNUM in IMAP table is the same as the list of distinct values of INV_RECNUM in VRS table. </p>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-24: Test If Damage in VDC0 Table Are within Allowable Range</h4>

<pre><code>
EQ-JP:
         PASS! MAXIMUM IN ALL RECORDS IS LESS THAN 100%!
         WARNING! Number of vdc0 curves with min number less than 1% = 1031
         A sample of records with min number less than 1%  :
         DC_KEY  PDC_NUM CGHS_ID Max_Damage
         2            2125            4           0.876 
   HAZ_TYPE HAZ_SCALE Count
1:       SH        SD    66
2:       SH       MMI   965
</code></pre>

<h4>Test-25: Vulnerability Alternative Curve Tests</h4>

<ol>
<li>Test Completeness of data</li>
<li>Test that vdc2&lt;=vdc0&lt;=vdc1</li>
</ol>

<pre><code>
JP:
</code></pre>

<h4>Test-26: Test Vlifelinebidc Table is Monotonically Increasing</h4>

<pre><code>
CHECK RISKLINK TABLES: 

JP:


CHECK NG TABLES: 
         PASS! HAZARD AXIS  ON ALL CURVES ARE MONOTONICALLY INCREASING!
         PASS! MDR AXIS  ON ALL CURVES ARE MONOTONICALLY INCREASING!
</code></pre>

<h4>Test-27: Minimum Value of MDR in CV Curves Should Start from Zero and Maximum Should be Above 100</h4>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-28: Test to Ensures Count of Modifier Options for A Given Modifier In A Given Model Does Not Exceed The Allowable Maximum.</h4>

<pre><code>
EQ-JP:
FAIL! Number of modif PDCs that have more than allowable options  = 3
   MODIF_NUM NumOfOptions PERIL MAXOPTIONCOUNT                  DESC
1:         7            4    EQ              3     Building Exterior
2:        16            4    EQ              3 Engineered Foundation
3:        25            4    EQ              3        Base Isolation
</code></pre>

<h4>Test-29: Consistency of x_CLASSIF and x_CLASS values across all perils for each country</h4>

<pre><code>
JP:

Country Perils are: 
[1] &quot;eq&quot;
         Database only includes one peril for this country.
</code></pre>

<h4>Test-30: All codes in VGEO table should exist in NGGeography database</h4>

<pre><code>
EQ-JP:
         CRESTA:
</code></pre>

<pre><code>Error in if (!is.na(FieldLookup$CRESTA)) {: argument is of length zero
</code></pre>

<h4>Test-31  Test if summation of def_invpct in inv table adds up to 100</h4>

<pre><code>
EQ-JP:
         This INV_OCC(s) is/are not considered in this query: BR%
         PASS! summation of ALL def_invpct in vinv adds up to 100!
</code></pre>

<h4>Test-32 Check if the list of distinct values of INV_RECNUM in IMAP table is the same as the list of distinct values of INV_RECNUM in vinv table</h4>

<pre><code>
EQ-JP:
         PASS! ALL RECORDS MATCHED!
</code></pre>

<h4>Test-33 CONSISTENCY OF BI_OCC BETWEEN VOCC AND OTHER BI RELATED TABLES (KEY IS BI_OCC)</h4>

<pre><code>
EQ-JP:
[1] &quot;NOTE: BI_OCCs related to BR and MARINE are exempted in this test!&quot;
[1] &quot;BI Related tables are :&quot;
              name
1:        eqvoccjp
2:         eqvbijp
3:      eqvbimodjp
4: eqvlifelinebijp
5:      eqvllbicjp
6:       eqvpbicjp

         eqvllbicjp: 
         Missing BI_OCC: 
         40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65

         eqvpbicjp: 
         Missing BI_OCC: 
         40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65

         FAIL! Number of tables with different BI_OCCs= 2
</code></pre>

<h4>Test-34 Check all columns in all tables of database to ensure always (From) is smaller than or equal to (To)</h4>

<pre><code>
EQ-JP:
         PASS! No records in eqcghsjp have FLOORAREA_FROM &gt; FLOORAREA_TO
         PASS! No records in eqcghsjp have FLOOR_FROM &gt; FLOOR_TO
         PASS! No records in eqvdsjp have FROM_DR &gt; TO_DR
         PASS! No records in eqimapjp have HT_FROM &gt; HT_TO
         PASS! No records in eqimapjp have YR_FROM &gt; YR_TO
         PASS! No records in eqvbistructmodifjp have STRUCTMDR_RATIO_FROM &gt; STRUCTMDR_RATIO_TO
         PASS! No records in eqvhsrjp have SEV_FROM &gt; SEV_TO
         PASS! No records in eqfliinvjp have HT_FROM &gt; HT_TO
         PASS! No records in eqfliinvjp have YR_FROM &gt; YR_TO
</code></pre>

<h4>Test-35 All BI_OCCs in vbi table should have SD based DSIDs in vds table.(KEY IS BI_OCC)</h4>

<pre><code>
EQ-JP:
         PASS! ALL BI_OCC(s) HAVE SD-Based Damage State ID!
</code></pre>

<h4>Test-36 Check for cases where YR_TO==9999 in the imap table. Jira MDF-114</h4>

<pre><code>
EQ-JP:
         PASS! No imap record has yr_to = 9999!
</code></pre>

<h4>Test-37.  Check Valid AggHaz_Occ list for RL climate models(HU,CS and WT) Jira MDF-101</h4>

<pre><code>         PASS! This test only applies to climate models.
</code></pre>

<h4>Test-38.  BI_CV curve should monotonically decrease with increase in MDR. Jira <a href="https://jira.rms.com/browse/MDF-120">https://jira.rms.com/browse/MDF-120</a></h4>

<pre><code>
EQ-JP:
         PASS! ALL BI_CV CURVES ARE MONOTONICALLY decreasing!
</code></pre>

</body>

</html>
