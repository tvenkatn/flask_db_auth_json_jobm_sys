# source("N:/APPLICS/EngTools/R_packages/Library/R_Utilities.R")

#---- INSTALL AND LOAD LIST OF PACKAGES ---------------------------
# RMS_load_packages(c("data.table","ggplot2"))
#------------------------------------------------------------------
RMS_load_packages <- function(packs) {

  for (i in 1:length(packs)){
    if (!(packs[i] %in% installed.packages())) {
      install.packages(packs[i], repos='http://cran.us.r-project.org')
    }
    library(packs[i], character.only=TRUE)
  }
}


#--- SET UP FOR THE RUN LOG FILE USING CAT_LOG() _----------------------
#    External dependencies:
#       cat_log_base : location and base filename of the cat_log file
#
#    2017.02.07  GilbertM
#-----------------------------------------------------------------------
setup_cat_log <- function(LogDir = "C:", filename = "CAT_LOG", localid = "") {
  cat_log_file <<- paste0(LogDir,"/",filename)   #--- Saved as Global variable ----
  Pid <<- localid   #--- Saved as Global variable ----
  cat(paste0(date(),"\n\n"), file=cat_log_file,append=FALSE)
}

cat_log <- function(x) {
  cat(paste(Pid,": ",x))
  cat(x, file=cat_log_file,append=TRUE)
}
#-----------------------------------------------------------------------


RMS_readJSON = function(configDir, configName) {
  library(rjson)
  #configDir<-getwd()
  con=file(paste0(configDir,"/",configName),open="r")
  line=readLines(con)
  commentMark<-"//"
  
  for(i in 1:length(line)) {
    #if(grepl(line[i],commentMark))
    abcd<-gregexpr(pattern=commentMark,line[i])
    pos<-abcd[[1]][1]
    if(pos==1){line[i]<-""}
    else if (pos>1) {line[i]<-strsplit(line[i],commentMark)[[1]][1]}
    else{}
  }
  
  close(con)
  return(fromJSON(paste(line, collapse="")))
  
}

#-----------------------------------------------------------------------
#This function checks the case sensitivity of the values in a column of table (Upper and Lower case)
CaseCheck<- function (tablename,columnname){
  
  return(data.table(sqlQuery(dbHandle,paste("
                                            select distinct ",columnname," Collate Latin1_General_CS_AI  from ",tablename,"
                                            except
                                            select distinct ",columnname, "from", tablename
  ))))
}
#-----------------------------------------------------------------------
#This function reads n character from the right side of a string
substrRight <- function(x, n){
  substr(x, nchar(x)-n+1, nchar(x))
}
#-----------------------------------------------------------------------

# Function to find peril-country from table name
PerilCountryFind <- function (tablename){
  Peril <- tolower(substring(tablename,1,5))
  if (substring(Peril,3,5)!="cas") {Peril <- substring(Peril,1,2)}
  country <- tolower(substring(tablename, nchar(tablename) - 1 ,nchar(tablename)))
  return(paste0(Peril,country))
}




